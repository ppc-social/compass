
#!/bin/sh
set -e

HOST=ouranos
DIR=/var/minecraft/webserver/compass
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

cd $SCRIPT_DIR

# upload src
rsync -r -u -v --delete --exclude .git --exclude dist --exclude __pycache__ --mkpath . $HOST:$DIR/src

if [[ "$1" == "u" ]] # only upload
then
  echo not running docker compuse up -d
else
  ssh $HOST 'sh -c "cd /var/minecraft && docker compose up -d --build compass-app"'
fi
